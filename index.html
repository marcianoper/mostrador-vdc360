<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Registro Mostrador VDC 360Â°</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f2f2f2;
      padding: 20px;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      max-width: 900px;
      margin: auto;
    }
    h1 {
      color: green;
    }
    label {
      display: block;
      margin-top: 15px;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
    }
    button {
      margin-top: 20px;
      padding: 12px;
      background-color: #1f6f26;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      width: 100%;
      font-weight: bold;
    }
    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
    }
    th, td {
      border: 2px solid #1f6f26;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #1f6f26;
      color: white;
    }
    .subtitulo {
      font-size: 22px;
      font-weight: bold;
      margin-top: 40px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Registro Mostrador VDC 360Â° matrix</h1>

    <label>Fecha:
      <input type="date" id="fecha" value="">
    </label>

    <label>Producto:
      <select id="producto">
        <option value="">Seleccionar</option>
        <option value="Caja menudo vÃ­sceras">Caja menudo vÃ­sceras</option>
        <option value="Caja Menudo National">Caja Menudo National</option>
        <option value="Panza">Panza</option>
        <option value="Libro">Libro</option>
        <option value="Tripa">Tripa</option>
        <option value="Tripa de rastro">TripÃ¡ de rastro</option>
        <option value="Corazon">Corazon</option>
        <option value="Higado">Higado</option>
        <option value="Sebo">Sebo</option>
        <option value="Pata Blanca">Pata Blanca</option>
        <option value="Pata Morena">Pata Morena</option>
        <option value="Cabeza sin lengua">Cabeza sin lengua</option>
        <option value="Bofe">Bofe</option>
        <option value="Tripa Gorda">Tripa gorda</option>
        <option value="Caja Excel">Caja Excel</option>
        <option value="Menudo Canadian">Menudo Canadian</option>
        <option value="Caja Washington">Caja Washington</option>
        <option value="Cabeza de res">Cabeza de res</option>
        <option value="Teleco">Teleco</option>
        <option value="Nana">Nana</option>
        <option value="Cabeza de Rastro">Cabeza de Rastro</option>
        <option value="Tripa de Rastro">Tripa de Rastro</option>
        <option value="Cabeza Congelada">Cabeza Congelada</option>
        <option value="Quajo">Quajo</option>
        <option value="Producto Libre">Producto Libre</option>
         <option value="Lengua">Lengua</option>
         <option value="Caja de tripa">Caja de tripa</option>
      </select>
    </label>

    <label>Kilos:
      <input type="number" id="kilos" />
    </label>

    <label>Piezas (opcional):
      <input type="number" id="piezas" />
    </label>

    <label>Origen:
      <input type="text" id="origen" />
    </label>

    <label>Â¿Es congelado?
      <select id="congelado">
        <option value="No">No</option>
        <option value="SÃ­">SÃ­</option>
      </select>
    </label>

    <button onclick="agregarProducto()">Agregar producto</button>

    <h2 class="subtitulo">Productos enviados</h2>
    <table id="tablaEnviados">
      <thead>
        <tr>
          <th>Producto</th>
          <th>Kilos</th>
          <th>Piezas</th>
          <th>Origen</th>
          <th>Congelado</th>
          <th>AcciÃ³n</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <h2 class="subtitulo">Productos devueltos</h2>
    <label>Producto devuelto:
      <input type="text" id="productoDevuelto" />
    </label>

    <label>Kilos devueltos:
      <input type="number" id="kilosDevuelto" />
    </label>

    <button onclick="agregarDevuelto()">Agregar producto devuelto</button>

    <table id="tablaDevueltos">
      <thead>
        <tr>
          <th>Producto</th>
          <th>Kilos</th>
          <th>AcciÃ³n</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <button onclick="enviarWhatsApp()">Enviar resumen a WhatsApp</button>
  </div>

  <script>
    const enviados = [];
    const devueltos = [];

    function agregarProducto() {
      const producto = document.getElementById('producto').value;
      const kilos = document.getElementById('kilos').value;
      const piezas = document.getElementById('piezas').value || 0;
      const origen = document.getElementById('origen').value;
      const congelado = document.getElementById('congelado').value;

      if (!producto || !kilos || !origen) {
        alert("Por favor completa los campos obligatorios.");
        return;
      }

      enviados.push({ producto, kilos, piezas, origen, congelado });
      renderTablaEnviados();
    }

    function agregarDevuelto() {
      const producto = document.getElementById('productoDevuelto').value;
      const kilos = document.getElementById('kilosDevuelto').value;

      if (!producto || !kilos) {
        alert("Completa ambos campos del producto devuelto.");
        return;
      }

      devueltos.push({ producto, kilos });
      renderTablaDevueltos();
    }

    function eliminarProducto(index) {
      enviados.splice(index, 1);
      renderTablaEnviados();
    }

    function eliminarDevuelto(index) {
      devueltos.splice(index, 1);
      renderTablaDevueltos();
    }

    function renderTablaEnviados() {
      const tbody = document.querySelector("#tablaEnviados tbody");
      tbody.innerHTML = "";
      enviados.forEach((item, index) => {
        tbody.innerHTML += `
          <tr>
            <td>${item.producto}</td>
            <td>${item.kilos}</td>
            <td>${item.piezas}</td>
            <td>${item.origen}</td>
            <td>${item.congelado}</td>
            <td><button onclick="eliminarProducto(${index})">Eliminar</button></td>
          </tr>`;
      });
    }

    function renderTablaDevueltos() {
      const tbody = document.querySelector("#tablaDevueltos tbody");
      tbody.innerHTML = "";
      devueltos.forEach((item, index) => {
        tbody.innerHTML += `
          <tr>
            <td>${item.producto}</td>
            <td>${item.kilos}</td>
            <td><button onclick="eliminarDevuelto(${index})">Eliminar</button></td>
          </tr>`;
      });
    }

    function enviarWhatsApp() {
      const fecha = document.getElementById("fecha").value;

      const agrupadoEnviados = {};
      const agrupadoDevueltos = {};
      let totalKilosEnviados = 0;
      let totalKilosDevueltos = 0;

      // Agrupar productos enviados
      enviados.forEach(p => {
        if (!agrupadoEnviados[p.producto]) {
          agrupadoEnviados[p.producto] = { kilos: 0, piezas: 0 };
        }
        agrupadoEnviados[p.producto].kilos += parseFloat(p.kilos);
        agrupadoEnviados[p.producto].piezas += parseInt(p.piezas || 0);
        totalKilosEnviados += parseFloat(p.kilos);
      });

      // Agrupar productos devueltos
      devueltos.forEach(p => {
        if (!agrupadoDevueltos[p.producto]) {
          agrupadoDevueltos[p.producto] = 0;
        }
        agrupadoDevueltos[p.producto] += parseFloat(p.kilos);
        totalKilosDevueltos += parseFloat(p.kilos);
      });

      let mensaje = `*Resumen VDC 360Â° - ${fecha}*\n\n`;
      mensaje += `ðŸŸ¢ *Productos enviados:*\n`;
      for (const [producto, datos] of Object.entries(agrupadoEnviados)) {
        mensaje += `â€¢ ${producto}: ${datos.kilos.toFixed(2)} kg / ${datos.piezas} pzas\n`;
      }

      mensaje += `\nðŸ“¦ *Total kilos enviados:* ${totalKilosEnviados.toFixed(2)} kg\n`;

      if (devueltos.length > 0) {
        mensaje += `\nðŸ”´ *Productos devueltos:*\n`;
        for (const [producto, kilos] of Object.entries(agrupadoDevueltos)) {
          mensaje += `â€¢ ${producto}: ${kilos.toFixed(2)} kg\n`;
        }
        mensaje += `\nðŸ“¦ *Total kilos devueltos:* ${totalKilosDevueltos.toFixed(2)} kg\n`;
      }

      const url = `https://wa.me/?text=${encodeURIComponent(mensaje)}`;
      window.open(url, "_blank");
    }

    document.getElementById("fecha").valueAsDate = new Date();
  </script>
</body>
</html>
