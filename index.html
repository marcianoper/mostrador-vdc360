<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro de Envíos a Mostrador - VDC 360°</title>
  <style>
    body { font-family: sans-serif; background: #f0f0f0; padding: 20px; }
    .bloque { background: white; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 0 10px #ccc; }
    input, select { padding: 8px; margin: 5px 0; width: 100%; border: 1px solid #ccc; border-radius: 4px; }
    button { padding: 10px 20px; background: green; color: white; border: none; border-radius: 4px; cursor: pointer; margin-top: 10px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #999; padding: 8px; text-align: center; }
    th { background: #e0e0e0; }
    .resaltado { background-color: #d1f7c4; }
  </style>
</head>
<body>
  <div class="bloque">
    <h2>Registro de productos enviados</h2>
    <label>Fecha</label>
    <input type="date" id="fecha">
    <label>Producto</label>
    <select id="producto"></select>
    <label>Kilos</label>
    <input type="number" id="kilos">
    <label>Piezas (opcional)</label>
    <input type="number" id="piezas">
    <label>Origen</label>
    <select id="origen">
      <option value="rastro">Rastro</option>
      <option value="limpieza">Limpieza</option>
      <option value="congelado">Congelado</option>
    </select>
    <button onclick="agregarProducto()">Agregar</button>
  </div>

  <div class="bloque">
    <h2>Registro de productos devueltos</h2>
    <label>Producto</label>
    <select id="productoDevuelto"></select>
    <label>Kilos devueltos</label>
    <input type="number" id="kilosDevueltos">
    <button onclick="agregarDevolucion()">Agregar devolución</button>
  </div>

  <div class="bloque">
    <h2>Resumen del Envío</h2>
    <table id="tablaResumen">
      <thead>
        <tr>
          <th>Producto</th><th>Origen</th><th>Total Kilos</th><th>Piezas</th><th>Devueltos</th><th>Netos</th><th>Eliminar</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button onclick="generarDocumento()">Generar Documento</button>
  </div>

  <script>
    const productos = [
      "Bofe", "Corazón", "Hígado", "Lengua de res", "Tripa",
      "Cuajo", "Panza fresca o menudo fresco", "Libro", "Pata blanca", "Pata morena",
      "Tripa de rastro", "Cabeza de res con lengua", "Cabeza sin lengua", "Teleco",
      "Caja menudo vísceras", "Menudo National", "Caja de Menudo National", "Caja Excel",
      "Menudo Canadian", "Cabeza de Rastro", "Sebo", "Tripa Gorda", "Nana",
      "Producto libre personalizado"
    ];

    let registros = [];

    function llenarSelects() {
      productos.forEach(prod => {
        const opt1 = document.createElement('option');
        const opt2 = document.createElement('option');
        opt1.textContent = opt2.textContent = prod;
        opt1.value = opt2.value = prod;
        document.getElementById('producto').appendChild(opt1);
        document.getElementById('productoDevuelto').appendChild(opt2);
      });
    }

    function agregarProducto() {
      const producto = document.getElementById('producto').value;
      const kilos = parseFloat(document.getElementById('kilos').value) || 0;
      const piezas = parseInt(document.getElementById('piezas').value) || 0;
      const origen = document.getElementById('origen').value;
      if (!producto || kilos <= 0) return;

      const existe = registros.find(r => r.producto === producto && r.origen === origen);
      if (existe) {
        existe.kilos += kilos;
        existe.piezas += piezas;
      } else {
        registros.push({ producto, origen, kilos, piezas, devueltos: 0 });
      }
      document.getElementById('kilos').value = '';
      document.getElementById('piezas').value = '';
      actualizarTabla();
    }

    function agregarDevolucion() {
      const producto = document.getElementById('productoDevuelto').value;
      const kilos = parseFloat(document.getElementById('kilosDevueltos').value) || 0;
      if (!producto || kilos <= 0) return;

      const existe = registros.find(r => r.producto === producto);
      if (existe) existe.devueltos += kilos;
      document.getElementById('kilosDevueltos').value = '';
      actualizarTabla();
    }

    function eliminarFila(index) {
      registros.splice(index, 1);
      actualizarTabla();
    }

    function actualizarTabla() {
      const tbody = document.querySelector('#tablaResumen tbody');
      tbody.innerHTML = '';
      registros.forEach((r, i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${r.producto}</td>
          <td>${r.origen}</td>
          <td>${r.kilos.toFixed(2)}</td>
          <td>${r.piezas}</td>
          <td>${r.devueltos.toFixed(2)}</td>
          <td class="resaltado">${(r.kilos - r.devueltos).toFixed(2)}</td>
          <td><button onclick="eliminarFila(${i})">Eliminar</button></td>
        `;
        tbody.appendChild(tr);
      });
    }

    function generarDocumento() {
      let texto = `Resumen del día ${document.getElementById('fecha').value}\n\n`;
      registros.forEach(r => {
        texto += `${r.producto} (${r.origen}):\n  Kilos enviados: ${r.kilos.toFixed(2)}\n  Devueltos: ${r.devueltos.toFixed(2)}\n  Netos: ${(r.kilos - r.devueltos).toFixed(2)}\n  Piezas: ${r.piezas}\n\n`;
      });
      const blob = new Blob([texto], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `envios_mostrador_${document.getElementById('fecha').value}.txt`;
      a.click();
    }

    window.onload = () => {
      llenarSelects();
      const hoy = new Date().toISOString().split('T')[0];
      document.getElementById('fecha').value = hoy;
    };
  </script>
</body>
</html>
